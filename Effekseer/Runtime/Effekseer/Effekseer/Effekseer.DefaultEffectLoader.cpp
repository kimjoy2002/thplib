
//----------------------------------------------------------------------------------
// Include
//----------------------------------------------------------------------------------
#include "Effekseer.DefaultEffectLoader.h"

//----------------------------------------------------------------------------------
//
//----------------------------------------------------------------------------------
namespace Effekseer { 
//----------------------------------------------------------------------------------
//
//----------------------------------------------------------------------------------
DefaultEffectLoader::DefaultEffectLoader()
{	
}
//----------------------------------------------------------------------------------
//
//----------------------------------------------------------------------------------
DefaultEffectLoader::~DefaultEffectLoader()
{

}

//----------------------------------------------------------------------------------
//
//----------------------------------------------------------------------------------
bool DefaultEffectLoader::Load( const EFK_CHAR* path, void*& data, int32_t& size )
{
#ifdef _WIN32
	data = NULL;
	size = 0;

	FILE* fp = _wfopen( (const wchar_t*)path, L"rb" );
	if( fp == NULL ) return false;

	fseek( fp, 0, SEEK_END );
	size = (int32_t)ftell( fp );
	data = new uint8_t[size];
	fseek( fp, 0, SEEK_SET );
	fread( data, 1, size, fp );
	fclose( fp );
	
	return true;
#else
	data = NULL;
	size = 0;

	int8_t dstpath[256];
	ConvertUtf16ToUtf8( dstpath, 256, (const int16_t*)path );

	FILE* fp = fopen( (const char*)dstpath, "rb" );
	if( fp == NULL ) return false;

	fseek( fp, 0, SEEK_END );
	size = (int32_t)ftell( fp );
	data = new uint8_t[size];
	fseek( fp, 0, SEEK_SET );
	fread( data, 1, size, fp );
	fclose( fp );

	return true;
#endif
}

//----------------------------------------------------------------------------------
//
//----------------------------------------------------------------------------------
void DefaultEffectLoader::Unload( void* data, int32_t size )
{
	ES_SAFE_DELETE_ARRAY( data );
}

//----------------------------------------------------------------------------------
//
//----------------------------------------------------------------------------------
 } 
//----------------------------------------------------------------------------------
//
//----------------------------------------------------------------------------------
